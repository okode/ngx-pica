!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs"),require("exif-js"),require("pica/dist/pica.js"),require("@angular/core")):"function"==typeof define&&define.amd?define("@digitalascetic/ngx-pica",["exports","rxjs","exif-js","pica/dist/pica.js","@angular/core"],t):t((e.digitalascetic=e.digitalascetic||{},e.digitalascetic["ngx-pica"]={}),e.rxjs,e.EXIF,e.Pica,e.ng.core)}(this,function(e,g,f,t,i){"use strict";t=t&&t.hasOwnProperty("default")?t["default"]:t;var d="NO_FILES_RECEIVED",h="CANVAS_CONTEXT_IDENTIFIER_NOT_SUPPORTED",p="NOT_BE_ABLE_TO_COMPRESS_ENOUGH",n=function(){function e(){}return e.prototype.getExifOrientedImage=function(p){return new Promise(function(u,e){f.getData(p,function(){var e=f.getAllTags(p).Orientation;if(e){if(!/^[1-8]$/.test(e))throw new Error("orientation should be [1-8]");var t=document.createElement("canvas"),i=t.getContext("2d"),n=0,r=0,a=0,c=p.width,o=p.height;switch(-1<[5,6,7,8].indexOf(e)&&(c=p.height,o=p.width),t.width=c,t.height=o,e){case 3:case 4:r=-p.width,a=-p.height,n=180;break;case 5:case 6:a=-p.height,n=90;break;case 7:case 8:r=-p.width,n=270}-1<[2,4,5,7].indexOf(e)&&(i.translate(c,0),i.scale(-1,1)),i.rotate(n/180*Math.PI),i.drawImage(p,r,a);var s=new Image;s.width=c,s.height=o,s.onload=function(){u(s)},s.src=t.toDataURL()}else u(p)})})},e.decorators=[{type:i.Injectable}],e}(),r=function(){function e(e){this._ngxPicaExifService=e,this.picaResizer=new t,this.MAX_STEPS=20,this.picaResizer&&this.picaResizer.resize||(this.picaResizer=new window.Pica)}return e.prototype.resizeImages=function(t,e,n,r){var a=this,c=new g.Subject,o=t.length;if(0<o){var s=new g.Subject,u=0,p=s.subscribe(function(i){a.resizeImage(i,e,n,r).subscribe(function(e){u++,c.next(e),u<o?s.next(t[u]):(c.complete(),p.unsubscribe())},function(e){var t={file:i,err:e};c.error(t)})});s.next(t[u])}else{var i={err:d};c.error(i),c.complete()}return c.asObservable()},e.prototype.resizeImage=function(r,a,c,o){var s=this,u=new g.Subject,p=document.createElement("canvas"),f=p.getContext("2d"),d=new Image;return f?(d.onload=function(){s._ngxPicaExifService.getExifOrientedImage(d).then(function(e){window.URL.revokeObjectURL(d.src),p.width=e.width,p.height=e.height,f.drawImage(e,0,0);var t=f.getImageData(0,0,e.width,e.height);if(o&&o.aspectRatio&&o.aspectRatio.keepAspectRatio){var i=0;i=o.aspectRatio.forceMinDimensions?Math.max(a/t.width,c/t.height):Math.min(a/t.width,c/t.height),a=Math.round(t.width*i),c=Math.round(t.height*i)}var n=document.createElement("canvas");n.width=a,n.height=c,s.picaResize(r,p,n,o)["catch"](function(e){return u.error(e)}).then(function(e){u.next(e)})})},d.src=window.URL.createObjectURL(r)):u.error(h),u.asObservable()},e.prototype.compressImages=function(t,e){var n=this,r=new g.Subject,a=t.length;if(0<a){var c=new g.Subject,o=0,s=c.subscribe(function(i){n.compressImage(i,e).subscribe(function(e){o++,r.next(e),o<a?c.next(t[o]):(r.complete(),s.unsubscribe())},function(e){var t={file:i,err:e};r.error(t)})});c.next(t[o])}else{var i={err:d};r.error(i),r.complete()}return r.asObservable()},e.prototype.compressImage=function(i,t){var n=this,r=new g.Subject;if(this.bytesToMB(i.size)<=t)setTimeout(function(){r.next(i)});else{var a=document.createElement("canvas"),c=a.getContext("2d"),o=new Image;c?(o.onload=function(){n._ngxPicaExifService.getExifOrientedImage(o).then(function(e){window.URL.revokeObjectURL(o.src),a.width=e.width,a.height=e.height,c.drawImage(e,0,0),n.getCompressedImage(a,i.type,1,t,0)["catch"](function(e){return r.error(e)}).then(function(e){var t=n.blobToFile(e,i.name,i.type,(new Date).getTime());r.next(t)})})},o.src=window.URL.createObjectURL(i)):r.error(h)}return r.asObservable()},e.prototype.getCompressedImage=function(n,e,r,a,c){var o=this;return new Promise(function(t,i){o.picaResizer.toBlob(n,e,r)["catch"](function(e){return i(e)}).then(function(e){o.checkCompressedImageSize(n,e,r,a,c)["catch"](function(e){return i(e)}).then(function(e){t(e)})})})},e.prototype.checkCompressedImageSize=function(r,a,c,o,s){var u=this;return new Promise(function(e,t){if(s>u.MAX_STEPS)t(p);else if(u.bytesToMB(a.size)<o)e(a);else{var i=c-.1*c,n=s+1;e(u.getCompressedImage(r,a.type,i,o,n))}})},e.prototype.picaResize=function(n,e,r,a){var c=this;return new Promise(function(i,t){c.picaResizer.resize(e,r,a)["catch"](function(e){return t(e)}).then(function(e){return c.picaResizer.toBlob(e,n.type)}).then(function(e){var t=c.blobToFile(e,n.name,n.type,(new Date).getTime());i(t)})})},e.prototype.blobToFile=function(e,t,i,n){return new File([e],t,{type:i,lastModified:n})},e.prototype.bytesToMB=function(e){return e/1048576},e.decorators=[{type:i.Injectable}],e.ctorParameters=function(){return[{type:n}]},e}(),a=function(){function e(){this.imageExtensions=["ase","art","bmp","blp","cd5","cit","cpt","cr2","cut","dds","dib","djvu","egt","exif","gif","gpl","grf","icns","ico","iff","jng","jpeg","jpg","jfif","jp2","jps","lbm","max","miff","mng","msp","nitf","ota","pbm","pc1","pc2","pc3","pcf","pcx","pdn","pgm","PI1","PI2","PI3","pict","pct","pnm","pns","ppm","psb","psd","pdd","psp","px","pxm","pxr","qfx","raw","rle","sct","sgi","rgb","int","bw","tga","tiff","tif","vtf","xbm","xcf","xpm","3dv","amf","ai","awg","cgm","cdr","cmx","dxf","e2d","egt","eps","fs","gbr","odg","svg","stl","vrml","x3d","sxd","v2d","vnd","wmf","emf","art","xar","png","webp","jxr","hdp","wdp","cur","ecw","iff","lbm","liff","nrrd","pam","pcx","pgf","sgi","rgb","rgba","bw","int","inta","sid","ras","sun","tga"]}return e.prototype.isImage=function(e){var t=e.name.toLowerCase().substr(e.name.lastIndexOf(".")+1);return-1!==this.imageExtensions.indexOf(t)},e.decorators=[{type:i.Injectable}],e}(),c=function(){function e(){}return e.decorators=[{type:i.NgModule,args:[{providers:[{provide:r,useClass:r},{provide:n,useClass:n},{provide:a,useClass:a}]}]}],e}();e.NgxPicaModule=c,e.NgxPicaService=r,e.NgxPicaImageService=a,e.Éµa=n,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=digitalascetic-ngx-pica.umd.min.js.map